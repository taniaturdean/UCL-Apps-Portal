{"ast":null,"code":"import axios from\"../axios.js\";import useAuth from\"../hooks/useAuth\";import{useEffect}from\"react\";import{Link,useNavigate,useLocation}from\"react-router-dom\";axios.defaults.withCredentials=true;// Handle call back from auth url and set global auth state\nfunction LoginCallback(){var _location$state,_location$state$from;var _useAuth=useAuth(),setAuth=_useAuth.setAuth;var navigate=useNavigate();var location=useLocation();var from=((_location$state=location.state)===null||_location$state===void 0?void 0:(_location$state$from=_location$state.from)===null||_location$state$from===void 0?void 0:_location$state$from.pathname)||\"/\";var queryParams=new URLSearchParams(location.search);var result=queryParams.get(\"result\");useEffect(function(){if(result===\"allowed\"){var code=queryParams.get(\"code\");var state=queryParams.get(\"state\");axios.get(\"/oauth/token?state=\".concat(state,\"&code=\").concat(code)).then(function(response){console.log(response);if(response.data.auth){var user=response.data.result;var roles=response.data.roles;setAuth({user:user,roles:roles});// redirects user to where they were trying to go (or to home page)\nnavigate(from,{replace:true});}else{setAuth({});console.log(\"Failed to get token.\");// Redirect to a 404 unauthorised page\nnavigate('/Unauthorised',{replace:true});}}).catch(function(err){console.log(err);});}else{console.log(\"Authorisation request denied\");// Redirect to a 404 unauthorised page\nnavigate('/Unauthorised',{replace:true});}},[]);// empty dependency array to ensure this effect only runs once on mount\n}export default LoginCallback;","map":{"version":3,"names":["axios","useAuth","useEffect","Link","useNavigate","useLocation","defaults","withCredentials","LoginCallback","_location$state","_location$state$from","_useAuth","setAuth","navigate","location","from","state","pathname","queryParams","URLSearchParams","search","result","get","code","concat","then","response","console","log","data","auth","user","roles","replace","catch","err"],"sources":["/Users/isobelbarkley/Documents/appeng/COMP0067_2023_Team09/ucl-apps-portal/client/src/pages/LoginCallback.js"],"sourcesContent":["import axios from \"../axios.js\";\nimport useAuth from \"../hooks/useAuth\";\nimport { useEffect } from \"react\";\nimport { Link, useNavigate, useLocation } from \"react-router-dom\";\n\naxios.defaults.withCredentials = true;\n\n// Handle call back from auth url and set global auth state\nfunction LoginCallback() {\n  const { setAuth } = useAuth();\n\n  const navigate = useNavigate();\n  const location = useLocation();\n  const from = location.state?.from?.pathname || \"/\"\n\n  const queryParams = new URLSearchParams(location.search);\n  const result = queryParams.get(\"result\");\n\n  useEffect(() => {\n    if (result === \"allowed\") {\n      const code = queryParams.get(\"code\");\n      const state = queryParams.get(\"state\");\n\n      axios\n        .get(`/oauth/token?state=${state}&code=${code}`)\n        .then((response) => {\n          console.log(response);\n          if (response.data.auth) {\n            const user = response.data.result;\n            const roles = response.data.roles;\n\n            setAuth({ user: user, roles: roles });\n\n            // redirects user to where they were trying to go (or to home page)\n            navigate(from, {replace: true});\n          } else {\n            setAuth({});\n            console.log(\"Failed to get token.\");\n            // Redirect to a 404 unauthorised page\n            navigate('/Unauthorised', {replace: true});\n          }\n        })\n        .catch((err) => {\n          console.log(err);\n        });\n    } else {\n      console.log(\"Authorisation request denied\");\n      // Redirect to a 404 unauthorised page\n      navigate('/Unauthorised', {replace: true});\n\n    }\n  }, []); // empty dependency array to ensure this effect only runs once on mount\n}\n\nexport default LoginCallback;"],"mappings":"AAAA,MAAO,CAAAA,KAAK,KAAM,aAAa,CAC/B,MAAO,CAAAC,OAAO,KAAM,kBAAkB,CACtC,OAASC,SAAS,KAAQ,OAAO,CACjC,OAASC,IAAI,CAAEC,WAAW,CAAEC,WAAW,KAAQ,kBAAkB,CAEjEL,KAAK,CAACM,QAAQ,CAACC,eAAe,CAAG,IAAI,CAErC;AACA,QAAS,CAAAC,aAAaA,CAAA,CAAG,KAAAC,eAAA,CAAAC,oBAAA,CACvB,IAAAC,QAAA,CAAoBV,OAAO,EAAE,CAArBW,OAAO,CAAAD,QAAA,CAAPC,OAAO,CAEf,GAAM,CAAAC,QAAQ,CAAGT,WAAW,EAAE,CAC9B,GAAM,CAAAU,QAAQ,CAAGT,WAAW,EAAE,CAC9B,GAAM,CAAAU,IAAI,CAAG,EAAAN,eAAA,CAAAK,QAAQ,CAACE,KAAK,UAAAP,eAAA,kBAAAC,oBAAA,CAAdD,eAAA,CAAgBM,IAAI,UAAAL,oBAAA,iBAApBA,oBAAA,CAAsBO,QAAQ,GAAI,GAAG,CAElD,GAAM,CAAAC,WAAW,CAAG,GAAI,CAAAC,eAAe,CAACL,QAAQ,CAACM,MAAM,CAAC,CACxD,GAAM,CAAAC,MAAM,CAAGH,WAAW,CAACI,GAAG,CAAC,QAAQ,CAAC,CAExCpB,SAAS,CAAC,UAAM,CACd,GAAImB,MAAM,GAAK,SAAS,CAAE,CACxB,GAAM,CAAAE,IAAI,CAAGL,WAAW,CAACI,GAAG,CAAC,MAAM,CAAC,CACpC,GAAM,CAAAN,KAAK,CAAGE,WAAW,CAACI,GAAG,CAAC,OAAO,CAAC,CAEtCtB,KAAK,CACFsB,GAAG,uBAAAE,MAAA,CAAuBR,KAAK,WAAAQ,MAAA,CAASD,IAAI,EAAG,CAC/CE,IAAI,CAAC,SAACC,QAAQ,CAAK,CAClBC,OAAO,CAACC,GAAG,CAACF,QAAQ,CAAC,CACrB,GAAIA,QAAQ,CAACG,IAAI,CAACC,IAAI,CAAE,CACtB,GAAM,CAAAC,IAAI,CAAGL,QAAQ,CAACG,IAAI,CAACR,MAAM,CACjC,GAAM,CAAAW,KAAK,CAAGN,QAAQ,CAACG,IAAI,CAACG,KAAK,CAEjCpB,OAAO,CAAC,CAAEmB,IAAI,CAAEA,IAAI,CAAEC,KAAK,CAAEA,KAAM,CAAC,CAAC,CAErC;AACAnB,QAAQ,CAACE,IAAI,CAAE,CAACkB,OAAO,CAAE,IAAI,CAAC,CAAC,CACjC,CAAC,IAAM,CACLrB,OAAO,CAAC,CAAC,CAAC,CAAC,CACXe,OAAO,CAACC,GAAG,CAAC,sBAAsB,CAAC,CACnC;AACAf,QAAQ,CAAC,eAAe,CAAE,CAACoB,OAAO,CAAE,IAAI,CAAC,CAAC,CAC5C,CACF,CAAC,CAAC,CACDC,KAAK,CAAC,SAACC,GAAG,CAAK,CACdR,OAAO,CAACC,GAAG,CAACO,GAAG,CAAC,CAClB,CAAC,CAAC,CACN,CAAC,IAAM,CACLR,OAAO,CAACC,GAAG,CAAC,8BAA8B,CAAC,CAC3C;AACAf,QAAQ,CAAC,eAAe,CAAE,CAACoB,OAAO,CAAE,IAAI,CAAC,CAAC,CAE5C,CACF,CAAC,CAAE,EAAE,CAAC,CAAE;AACV,CAEA,cAAe,CAAAzB,aAAa"},"metadata":{},"sourceType":"module","externalDependencies":[]}